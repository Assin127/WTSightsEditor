<Window x:Class="WTSightsEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WTSightsEditor"
        mc:Ignorable="d"
        Title="WT Sights Editor" 
        Height="800" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Loaded="Window_Loaded"
        SizeChanged="Window_SizeChanged">

    <Window.Resources>
        <!-- Define color scheme -->
        <SolidColorBrush x:Key="WindowBackground" Color="#FF1E1E1E"/>
        <SolidColorBrush x:Key="MenuBackground" Color="#FF2D2D30"/>
        <SolidColorBrush x:Key="MenuForeground" Color="#FFF0F0F0"/>
        <SolidColorBrush x:Key="MenuHighlight" Color="#FF3E3E42"/>
        <SolidColorBrush x:Key="PanelBackground" Color="#FF252526"/>
        <SolidColorBrush x:Key="PanelForeground" Color="#FFCCCCCC"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#FF3F3F46"/>
        <SolidColorBrush x:Key="HeaderBackground" Color="#FF007ACC"/>
        <SolidColorBrush x:Key="HeaderForeground" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="EditorBackground" Color="#FF1E1E1E"/>
        <SolidColorBrush x:Key="EditorForeground" Color="#FFD4D4D4"/>

        <!-- Menu Styles -->
        <Style TargetType="Menu">
            <Setter Property="Background" Value="{StaticResource MenuBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource MenuForeground}"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="MenuItem">
            <Setter Property="Foreground" Value="{StaticResource MenuForeground}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Border Name="Border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <ContentPresenter Margin="6,3,6,3" 
                                                  ContentSource="Header" 
                                                  RecognizesAccessKey="True"
                                                  VerticalAlignment="Center"/>
                                <Popup Name="Popup" 
                                       Placement="Bottom" 
                                       IsOpen="{TemplateBinding IsSubmenuOpen}" 
                                       AllowsTransparency="True" 
                                       Focusable="False" 
                                       PopupAnimation="Fade">
                                    <Border Name="SubmenuBorder" 
                                            SnapsToDevicePixels="True" 
                                            Background="{StaticResource MenuBackground}"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            BorderThickness="1"
                                            Padding="1">
                                        <StackPanel IsItemsHost="True" 
                                                    KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource MenuHighlight}"/>
                </Trigger>
                <Trigger Property="IsSubmenuOpen" Value="True">
                    <Setter Property="Background" Value="{StaticResource MenuHighlight}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Custom ToolBar Template with hidden vertical scrollbar -->
        <ControlTemplate x:Key="ToolBarTemplate" TargetType="{x:Type ToolBar}">
            <Border BorderBrush="{TemplateBinding BorderBrush}" 
            BorderThickness="{TemplateBinding BorderThickness}" 
            Background="{TemplateBinding Background}">
                <ScrollViewer x:Name="ToolBarScrollViewer"
                      VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Auto"
                      CanContentScroll="true"
                      Focusable="false">
                    <ToolBarPanel IsItemsHost="true" 
                          Margin="{TemplateBinding Padding}"
                          Orientation="Horizontal"/>
                </ScrollViewer>
            </Border>
        </ControlTemplate>

        <!-- Updated ToolBar Style -->
        <Style TargetType="ToolBar">
            <Setter Property="Background" Value="{StaticResource PanelBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Template" Value="{StaticResource ToolBarTemplate}"/>
        </Style>

        <!-- Button Style for ToolBar -->
        <Style TargetType="Button" x:Key="ToolBarButtonStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="4"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource MenuHighlight}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- TreeView Style -->
        <Style TargetType="TreeView">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource HeaderBackground}"/>
                    <Setter Property="Foreground" Value="{StaticResource HeaderForeground}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- TextBox Style -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource EditorBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource EditorForeground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CaretBrush" Value="{StaticResource EditorForeground}"/>
        </Style>

        <!-- CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
        </Style>

        <!-- TabControl Style -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource PanelBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Margin" Value="2,0"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource HeaderBackground}"/>
                    <Setter Property="Foreground" Value="{StaticResource HeaderForeground}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ListBox Style -->
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="ListBoxItem">
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource HeaderBackground}"/>
                    <Setter Property="Foreground" Value="{StaticResource HeaderForeground}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ComboBox Style -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource EditorBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- Slider Style -->
        <Style TargetType="Slider">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PanelForeground}"/>
        </Style>

        <!-- Separator Style -->
        <Style TargetType="Separator">
            <Setter Property="Background" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Margin" Value="5,2"/>
        </Style>

        <!-- Style for active tool button -->
        <Style x:Key="ActiveToolButtonStyle" TargetType="Button" BasedOn="{StaticResource ToolBarButtonStyle}">
            <Setter Property="Background" Value="{StaticResource HeaderBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource HeaderForeground}"/>
        </Style>
    </Window.Resources>

    <DockPanel Background="{StaticResource WindowBackground}">

        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <!-- File Menu -->
            <MenuItem Header="{DynamicResource MenuFile}">
                <MenuItem Header="{DynamicResource MenuFileNew}" InputGestureText="Ctrl+N"/>
                <MenuItem Header="{DynamicResource MenuFileOpen}" InputGestureText="Ctrl+O"/>
                <MenuItem Header="{DynamicResource MenuFileSave}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="{DynamicResource MenuFileSaveAs}" InputGestureText="Ctrl+Shift+S"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuFileImport}"/>
                <MenuItem Header="{DynamicResource MenuFileExport}"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuFileRecent}">
                    <!-- Recent files will be populated dynamically -->
                </MenuItem>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuFileExit}"/>
            </MenuItem>

            <!-- Edit Menu -->
            <MenuItem Header="{DynamicResource MenuEdit}">
                <MenuItem Header="{DynamicResource MenuEditUndo}" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="{DynamicResource MenuEditRedo}" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuEditCut}" InputGestureText="Ctrl+X"/>
                <MenuItem Header="{DynamicResource MenuEditCopy}" InputGestureText="Ctrl+C"/>
                <MenuItem Header="{DynamicResource MenuEditPaste}" InputGestureText="Ctrl+V"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuEditFind}" InputGestureText="Ctrl+F"/>
                <MenuItem Header="{DynamicResource MenuEditReplace}" InputGestureText="Ctrl+H"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuEditPreferences}"/>
            </MenuItem>

            <!-- View Menu -->
            <MenuItem Header="{DynamicResource MenuView}">
                <MenuItem Header="{DynamicResource MenuViewZoomIn}" InputGestureText="Ctrl++"/>
                <MenuItem Header="{DynamicResource MenuViewZoomOut}" InputGestureText="Ctrl+-"/>
                <MenuItem Header="{DynamicResource MenuViewResetZoom}" InputGestureText="Ctrl+0"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuViewGrid}"/>
                <MenuItem Header="{DynamicResource MenuViewCrosshair}"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuViewFullscreen}" InputGestureText="F11"/>
            </MenuItem>

            <!-- Tools Menu -->
            <MenuItem Header="{DynamicResource MenuTools}" x:Name="ToolsMenu">
                <MenuItem Header="{DynamicResource MenuToolsDatamine}"/>
                <MenuItem Header="{DynamicResource MenuToolsBallistic}"/>
                <MenuItem Header="{DynamicResource MenuToolsArmorPen}"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuToolsCustomEditor}" 
                          x:Name="CustomSightsEditorMenuItem"
                          Click="CustomSightsEditorMenuItem_Click"/>
            </MenuItem>

            <MenuItem Header="{DynamicResource MenuFileSettings}"/>

            <!-- Help Menu -->
            <MenuItem Header="{DynamicResource MenuHelp}">
                <MenuItem Header="{DynamicResource MenuHelpDocumentation}"/>
                <MenuItem Header="{DynamicResource MenuHelpSamples}"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MenuHelpAbout}"/>
            </MenuItem>
        </Menu>

        <!-- Main Toolbar -->
        <ToolBar DockPanel.Dock="Top" UseLayoutRounding="False">
            <!-- File Operations -->
            <Button x:Name="ToolbarNew" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuFileNew}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📄" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuFileNew}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarOpen" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuFileOpen}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📂" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuFileOpen}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarSave" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuFileSave}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="💾" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuFileSave}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarSaveAs" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuFileSaveAs}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="💾+" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuFileSaveAs}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- Import/Export -->
            <Button x:Name="ToolbarImport" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuFileImport}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⬇️" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuFileImport}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarExport" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuFileExport}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⬆️" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuFileExport}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- Edit Operations -->
            <Button x:Name="ToolbarUndo" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditUndo}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="↶" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditUndo}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarRedo" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditRedo}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="↷" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditRedo}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- Edit Tools -->
            <Button x:Name="ToolbarCut" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditCut}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="✂️" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditCut}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarCopy" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditCopy}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📋" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditCopy}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarPaste" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditPaste}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📝" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditPaste}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- Search -->
            <Button x:Name="ToolbarFind" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditFind}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditFind}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarReplace" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuEditReplace}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔄" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuEditReplace}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- View Operations -->
            <Button x:Name="ToolbarZoomIn" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuViewZoomIn}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍+" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuViewZoomIn}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarZoomOut" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuViewZoomOut}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍-" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuViewZoomOut}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarResetZoom" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuViewResetZoom}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍⟲" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuViewResetZoom}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <Button x:Name="ToolbarGrid" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuViewGrid}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⏹️" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuViewGrid}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarCrosshair" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuViewCrosshair}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="➕" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuViewCrosshair}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolbarFullscreen" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource MenuViewFullscreen}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⛶" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource MenuViewFullscreen}"/>
                </StackPanel>
            </Button>
        </ToolBar>

        <!-- Tools Toolbar for editing -->
        <ToolBar DockPanel.Dock="Top">

            <!-- Creation Tools -->
            <Button x:Name="ToolLine" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolLine}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📏" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolLine}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolCircle" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolCircle}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⭕" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolCircle}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolRectangle" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolRectangle}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⬛" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolRectangle}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolText" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolText}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="T" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolText}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- Selection and Manipulation Tools -->
            <Button x:Name="ToolSelect" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolSelect}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="👉" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolSelect}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolMove" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolMove}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="↔️" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolMove}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolClone" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolClone}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="👯" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolClone}"/>
                </StackPanel>
            </Button>
            <Button x:Name="ToolDelete" Style="{StaticResource ToolBarButtonStyle}" ToolTip="{DynamicResource ToolDelete}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🗑️" Margin="0,0,2,0"/>
                    <TextBlock Text="{DynamicResource ToolDelete}"/>
                </StackPanel>
            </Button>
            <Separator/>

            <!-- Dynamic Tools Placeholder (will be populated based on selected element) -->
            <StackPanel x:Name="DynamicToolsPanel" Orientation="Horizontal">
                <!-- Dynamic tools will be added here programmatically -->
            </StackPanel>
        </ToolBar>

        <!-- Main Content Area -->
        <Grid>
            <Grid.ColumnDefinitions>
                <!-- Left Panel: File Explorer -->
                <ColumnDefinition Width="250" MinWidth="0" MaxWidth="1000"/>
                <!-- Left Splitter -->
                <ColumnDefinition Width="5"/>
                <!-- Center Panel: Main content -->
                <ColumnDefinition Width="*" MinWidth="200"/>
                <!-- Right Splitter -->
                <ColumnDefinition Width="5"/>
                <!-- Right Panel: Code Editor -->
                <ColumnDefinition Width="350" MinWidth="0" MaxWidth="1000"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: File Explorer -->
            <Border Grid.Column="0" Background="{StaticResource PanelBackground}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- File Explorer Header -->
                    <Border Grid.Row="0" Background="{StaticResource HeaderBackground}" Padding="5">
                        <TextBlock Text="{DynamicResource FileExplorer}" 
                                   Foreground="{StaticResource HeaderForeground}" 
                                   FontWeight="Bold"/>
                    </Border>

                    <!-- File Explorer TreeView -->
                    <TreeView Grid.Row="1" BorderThickness="0">
                        <TreeViewItem Header="{DynamicResource Folders}">
                            <TreeViewItem Header="Sights"/>
                            <TreeViewItem Header="Templates"/>
                            <TreeViewItem Header="Resources"/>
                        </TreeViewItem>
                        <TreeViewItem Header="{DynamicResource RecentFiles}">
                            <!-- Will be populated dynamically -->
                        </TreeViewItem>
                    </TreeView>
                </Grid>
            </Border>

            <!-- Left Splitter -->
            <GridSplitter Grid.Column="1" 
                          Width="3" 
                          HorizontalAlignment="Stretch"
                          Background="{StaticResource BorderBrush}"
                          ResizeDirection="Columns"
                          ResizeBehavior="PreviousAndNext"/>

            <!-- Center Panel -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <!-- Main preview area - растягивается, но не менее 100px -->
                    <RowDefinition Height="2*" MinHeight="100"/>
                    <!-- Splitter для Custom Editor -->
                    <RowDefinition Height="5"/>
                    <!-- Custom Sights Editor - ограниченная высота -->
                    <RowDefinition Height="0" MinHeight="0" MaxHeight="1000" x:Name="CustomEditorRow"/>
                    <!-- Status Bar - фиксированная высота -->
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Main Preview Container с ClipToBounds -->
                <Border Grid.Row="0" 
        Background="Black" 
        BorderBrush="{StaticResource BorderBrush}" 
        BorderThickness="1"
        CornerRadius="2"
        Margin="5,5,5,0"
        ClipToBounds="True">
                    <!-- Grid для центрирования Canvas -->
                    <Grid x:Name="PreviewContainer" SizeChanged="PreviewContainer_SizeChanged">
                        <!-- Основной Canvas с центрированием -->
                        <Canvas x:Name="MainCanvas" 
                Background="Transparent"
                MouseDown="PreviewCanvas_MouseDown">
                            <!-- Здесь будет отображаться прицел -->
                        </Canvas>
                    </Grid>
                </Border>

                <!-- Splitter между Preview и Custom Editor -->
                <GridSplitter Grid.Row="1" 
              Height="3" 
              HorizontalAlignment="Stretch"
              Background="{StaticResource BorderBrush}"
              ResizeDirection="Rows"
              ResizeBehavior="PreviousAndNext"/>

                <!-- Custom Sights Editor Panel -->
                <Border x:Name="CustomEditorPanel" 
            Grid.Row="2" 
            Background="{StaticResource PanelBackground}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1,0,1,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Custom Editor Header -->
                        <Border Grid.Row="0" 
        Background="{StaticResource HeaderBackground}" 
        Padding="5"
        MouseDown="CustomEditorHeader_MouseDown">
                            <TextBlock Text="{DynamicResource CustomSightsEditor}" 
               Foreground="White" 
               FontWeight="Bold"/>
                        </Border>

                        <!-- Custom Editor Content -->
                        <Border Grid.Row="1" 
                    Background="{StaticResource EditorBackground}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,1,0,0">
                            <TextBlock Text="Custom sights editor content will appear here"
                           Foreground="{StaticResource PanelForeground}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           TextWrapping="Wrap"
                           TextAlignment="Center"
                           Margin="10"/>
                        </Border>
                    </Grid>
                </Border>

                <!-- Status Bar -->
                <Border Grid.Row="3" 
            Background="{StaticResource PanelBackground}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="0,1,0,0"
            Padding="5,2">
                    <DockPanel>
                        <!-- Left: Status Message -->
                        <TextBlock x:Name="StatusText"
                       DockPanel.Dock="Left"
                       Text="{DynamicResource StatusReady}"
                       Foreground="{StaticResource PanelForeground}"
                       VerticalAlignment="Center"/>

                        <!-- Right: Zoom and Resolution -->
                        <StackPanel DockPanel.Dock="Right"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right">
                            <TextBlock Text="{DynamicResource Resolution}" 
                           Foreground="{StaticResource PanelForeground}"
                           VerticalAlignment="Center"/>
                            <TextBlock x:Name="ResolutionText"
                           Text="1920x1080"
                           Foreground="{StaticResource PanelForeground}"
                           VerticalAlignment="Center"
                           Margin="5,0,10,0"
                           FontWeight="Bold"/>

                            <TextBlock Text="Zoom:" 
                           Foreground="{StaticResource PanelForeground}"
                           VerticalAlignment="Center"/>
                            <TextBlock x:Name="ZoomText"
                           Text="30%"
                           Foreground="{StaticResource PanelForeground}"
                           VerticalAlignment="Center"
                           Margin="5,0,0,0"
                           FontWeight="Bold"
                           Width="40"
                           TextAlignment="Right"/>
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>

            <!-- Right Splitter -->
            <GridSplitter Grid.Column="3" 
                          Width="3" 
                          HorizontalAlignment="Stretch"
                          Background="{StaticResource BorderBrush}"
                          ResizeDirection="Columns"
                          ResizeBehavior="PreviousAndNext"/>

            <!-- Right Panel: Code Editor -->
            <Border Grid.Column="4" Background="{StaticResource PanelBackground}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Code Editor Header -->
                    <Border Grid.Row="0" Background="{StaticResource HeaderBackground}" Padding="5">
                        <TextBlock Text="{DynamicResource CodeEditor}" 
                                   Foreground="{StaticResource HeaderForeground}" 
                                   FontWeight="Bold"/>
                    </Border>

                    <!-- Code Editor -->
                    <TextBox Grid.Row="1" 
                             x:Name="CodeEditor"
                             AcceptsReturn="True"
                             AcceptsTab="True"
                             FontFamily="Consolas"
                             FontSize="12"
                             Background="{StaticResource EditorBackground}"
                             Foreground="{StaticResource EditorForeground}"
                             BorderThickness="0"
                             TextWrapping="NoWrap"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto">
                        <!-- Example sight code -->
                        <TextBox.Text>
                            // War Thunder Sight Configuration
                            // Example sight code will appear here
                            {
                                "name": "Default Sight",
                                "version": "1.0",
                                "elements": [
                                    {
                                        "type": "circle",
                                        "position": [0, 0],
                                        "radius": 50,
                                        "color": "white",
                                        "thickness": 1
                                    }
                                ]
                            }
                        </TextBox.Text>
                    </TextBox>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>